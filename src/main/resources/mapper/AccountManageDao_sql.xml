<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ucar.combination.dao.AccountManageDao">

    <resultMap type="com.ucar.combination.model.Account" id="account">
        <result column="id" property="id"/>
        <result column="account_name" property="accountName"/>
        <result column="account_password" property="password"/>
        <result column="staff_id" property="staffId"/>
        <result column="staff_name" property="staffName"/>
        <result column="permissions" property="premissions"/>
        <result column="account_secret_email" property="secretEmail"/>
        <result column="create_emp" property="creatEmpId"/>
        <result column="staff_num" property="staffNum"/>
        <result column="department_id" property="departmentId"/>
        <result column="department_name" property="department"/>
        <result column="create_emp_name" property="creatEmpName"/>
        <result column="create_time" property="createTime"/>
        <result column="modify_emp" property="modifyEmpId"/>
        <result column="modify_emp_name" property="modifyEmpName"/>
        <result column="modify_time" property="modifyTime"/>
        <result column="account_state" property="accountState"/>
        <result column="account_remark" property="remark"/>
    </resultMap>

    <select id="queryList" resultMap="account">
        SELECT t1.id,
               account_name,
               t2.staff_name,
               t2.staff_num,
               t3.department_name,
               permissions,
               t4.staff_name modify_emp_name,
               t1.modify_time,
               account_state
        FROM t_account t1
                 LEFT JOIN t_staff t2
                           ON (staff_id = t2.id)
                 LEFT JOIN t_staff t4
                           ON (t1.modify_emp = t4.id)
                 LEFT JOIN t_department t3
                           ON (t2.department_id = t3.id)
        WHERE account_state != 0
        <if test="accountName != null and accountName.trim() != ''">
          and account_name = #{accountName}
        </if>
        <if test="staffName != null and staffName.trim() != ''">
          and t2.staff_name = #{staffName}
        </if>
        <if test="staffNum != null and staffNum.trim() != ''">
          and t2.staff_num = #{staffNum}
        </if>
        <if test="permissions != null and permissions.trim() != ''">
          and permissions = #{permissions}
        </if>
        <if test="departmentId != null and departmentId.trim() != ''">
            and t3.id = #{departmentId}
        </if>
        <if test="isRelStaff == 1 ">
            and t1.staff_id != 0
        </if>
        <if test="isRelStaff == 0 ">
            and t1.staff_id = 0
        </if>
        <if test="accountState != null and accountState.trim() != ''">
            and account_state = #{accountState}
        </if>
        ORDER BY id
    </select>
</mapper>


