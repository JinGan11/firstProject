<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ucar.combination.dao.DepartmentDao">
    <select id="queryDepartmentTreeAll" resultType="com.ucar.combination.model.dto.DepartmentTreeDto">
        SELECT
        id,
        department_no,
        department_name,
        upper_department_no
        FROM t_department
        WHERE status=1
        ORDER BY id
    </select>
    <insert id="insertDepartment" parameterType="com.ucar.combination.model.Department">
        insert into t_department(
            department_no,
            workplace,
            department_name,
            staff_id,
            staff_name,
            city_id,
            address,
            telephone,
            email,
            landline,
            level,
            upper_department_no,
            support_business,
            department_type,
            status,
            remark,
            longitude,
            latitude,
            create_emp,
            create_time,
            modify_emp,
            modify_time
        )
        values(
            #{departmentNo},
            #{workplace},
            #{departmentName},
            #{staffId},
            #{staffName},
            #{cityId},
            #{address},
            #{telephone},
            #{email},
            #{landline},
            #{level},
            #{upperDepartmentNo},
            #{supportBusiness},
            #{departmentType},
            #{status},
            #{remark},
            #{longitude},
            #{latitude},
            #{createEmp},
            now(),
            #{modifyEmp},
            now()
        )
    </insert>
    <update id="deleteDepartment">
        UPDATE t_department
        SET status=0
        WHERE id=#{id}
    </update>

    <select id="searchDepartment" resultType="com.ucar.combination.model.dto.SearchDepartmentDto">
        SELECT
        T.id,
        T.department_no,
        T.workplace,
        T.department_name,
        T.staff_id,
        T.staff_name,
        T.city_id,
        T.address,
        T.telephone,
        T.email,
        T.landline,
        T.upper_department_no,
        T.support_business,
        T.department_type,
        T.status,
        T.create_emp,
        T.create_time,
        T.modify_emp,
        T.modify_time,
        T.remark,
        T1.city_name,
        T3.company_name
        FROM t_department T join t_b_city T1 on T.city_id=T1.city_id
        join t_r_department_company T2 on T.id=T2.department_id join
        t_company T3 on T2.company_id=T3.id
        <where>
            <if test="staffId !=null and staffId.trim()!=''">AND T.staff_id=#{staffId}</if>
            <if test="departmentName != null and departmentName.trim()!=''">AND T.department_name=#{departmentName}</if>
            <if test="staffName != null and staffName.trim()!=''">AND T.staff_name=#{staffName}</if>
            <if test="staffId != null and staffId.trim()!=''">AND T.staff_id=#{staffId}</if>
            <if test="telephone != null and telephone.trim()!=''">AND T.telephone=#{telephone}</if>
            <if test="cityName != null and cityName.trim()!=''">AND T1.city_name=#{cityName}</if>
            <if test="level != null and level.trim()!=''">AND T.level=#{level}</if>
            <if test="upperDepartmentNo != null and upperDepartmentNo.trim()!=''">AND
                T.upper_department_no=#{upperDepartmentNo}
            </if>
            <if test="status != null and status.trim()!=''">AND T.status=#{status}</if>
            <if test="departmentType != 0 and departmentType != null and departmentType.trim()!=''">AND
                T.department_type=#{departmentType}
            </if>
        </where>
    </select>
    <select id="getDepartmentById" parameterType="java.lang.Long" resultType="com.ucar.combination.model.Department">
        SELECT T.id,
        T.department_no,
        T.workplace,
        T.department_name,
        T.staff_id,
        T.staff_name,
        T.city_id,
        T.address,
        T.telephone,
        T.email,
        T.landline,
        T.level,
        T.upper_department_no,
        T.support_business,
        T.department_type,
        T.status,
        T.create_emp,
        T.create_time,
        T.modify_emp,
        T.modify_time,
        T.remark
        from  t_department T
        where T.id=#{id};
    </select>
</mapper>
