<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ucar.combination.dao.EmployeeManageDao">
    <select id="queryList" resultType="com.ucar.combination.model.dto.StaffDto">
        SELECT
        M.id,
        createTime,
        t3.account_name,
        staffNum,
        accountId,
        staffName,
        staffSex,
        staffTelephone,
        staffEmail,
        departmentName,
        upperDepartmentName,
        isDimission,
        upperDepartmentNo
        FROM
        (SELECT
        t1.id id,
        t1.staff_num staffNum,
        t1.account_id accountId,
        t1.staff_name staffName,
        t1.staff_sex staffSex,
        t1.staff_telephone staffTelephone,
        t1.staff_email staffEmail,
        t1.department_id departmentId,
        t1.is_dimission isDimission,
        t1.create_time createTime,
        t2.upper_department_no upperDepartmentNo,
        t2.department_name departmentName,
        t4.department_name upperDepartmentName
        FROM t_staff t1,t_department t2,t_department t4
        where t1.department_id = t2.id and t2.upper_department_no=t4.department_no) M
        LEFT JOIN t_account t3
        on  t3.id=M.accountId
        where 1=1
        <if test="satff_num != null and satff_num.trim() != ''">
            AND staffNum =#{satff_num}
        </if>
        <if test="staff_name != null and staff_name.trim() != ''">
            AND staffName =#{staff_name}
        </if>
        <if test="accountName != null and accountName.trim() != ''">
            AND t3.account_name=#{accountName}
        </if>
        <if test="is_dimission != null and is_dimission.trim() != ''">
            AND isDimission =#{is_dimission}
        </if>
        <if test="department != null and department.trim() != ''">
            AND upperDepartmentNo =#{upper_department_no}
        </if>
        ORDER BY createTime DESC
    </select>

    <select id="qryStaffById" parameterType="com.ucar.combination.model.User"
            resultType="com.ucar.combination.model.Staff">
        SELECT
        ts.id,
        ts.staff_num,
        ts.staff_name,
        ts.staff_sex,
        ts.staff_telephone,
        ts.staff_email,
        ts.department_id,
        ts.is_dimission ,
        td.department_name
        FROM t_staff ts,t_department td
        where ts.department_id = td.id
        and ts.id = #{staffId}
    </select>
    <insert id="insertStaff" parameterType="com.ucar.combination.model.Staff">
        insert into t_staff(staff_num,staff_name,staff_sex,staff_telephone,staff_email,department_id,is_dimission,status, create_time, create_emp, modify_time, modify_emp,remark)
        value(#{staffNum}, #{staffName},#{staffSex},#{staffTelephone},#{staffEmail},#{departmentId},#{isDimission},1, NOW(), 1, NOW(), 1,#{remark})
    </insert>
</mapper>
