<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ucar.combination.dao.RoleApplyManageDao">
    <select id="queryList" resultType="com.ucar.combination.model.dto.RoleApplyDto">
        select t1.id                id,
        t1.apply_num                roleApplyNum,
        t1.role_id                  roleId,
        t2.role_name                roleName,
        t2.approver_staff_name      approverStaffName,
        t2.business_line            businessLine,
        t1.apply_account_name       applyAccountName,
        t1.apply_staff_num          applyStaffNum,
        t1.apply_staff_name         applyStaffName,
        t1.apply_department_name    applyDepartmentName,
        t1.apply_time               applyTime,
        t1.status                   applyStatus,
        t1.modify_emp               modifyEmp,
        t1.modify_time              modifyTime,
        t1.reject_reason            rejectReason
        from t_role_apply t1,t_role_info t2
        where t1.role_id=t2.id
        <if test="roleApplyNum!=null and roleApplyNum!=''">
            AND t1.apply_num=#{roleApplyNum}
        </if>
        <if test="roleId!=null and roleId!=''">
            AND t1.role_id=#{roleId}
        </if>
        <if test="roleName!=null and roleName!=''">
            AND t2.role_name=#{roleName}
        </if>
        <if test="applyAccountName!=null and applyAccountName!=''">
            AND t1.apply_account_name=#{applyAccountName}
        </if>
        <if test="applyStaffNum!=null and applyStaffNum!=''">
            AND t1.apply_staff_num =#{applyStaffNum}
        </if>
        <if test="applyStaffName!=null and applyStaffName!=''">
            AND t1.apply_staff_name=#{applyStaffName}
        </if>
        <if test="applyDepartmentName!=null and applyDepartmentName!=''">
            AND t1.apply_department_name=#{applyDepartmentName}
        </if>
        <if test="applyStatus!=null and applyStatus!=''">
            AND t1.status=#{applyStatus}
        </if>
        <if test="accountId!=null and accountId!=''">
            AND t1.apply_account_id=#{accountId}
        </if>
        <if test="applyTimeStart!=null and applyTimeStart!=''">
            AND t1.apply_time<![CDATA[ <= ]]> #{applyTimeStart}
        </if>
        <if test="applyTimeEnd!=null and applyTimeEnd!=''">
            AND t1.apply_time<![CDATA[ <= ]]> #{applyTimeEnd}
        </if>
        <if test="modifyTimeStart!=null and modifyTimeStart!=''">
            AND t1.modify_time<![CDATA[ >= ]]> #{modifyTimeStart}
        </if>
        <if test="modifyTimeEnd!=null and modifyTimeEnd!=''">
            AND t1.modify_time<![CDATA[ <= ]]> #{modifyTimeEnd}
        </if>

    </select>


    <!--删除角色申请-->
    <update id="deleteRoleApply">
        update t_role_apply t1
        set t1.status=5
        where t1.apply_num = #{roleApplyNum}
    </update>

    <!--提交角色申请-->
    <update id="commitRoleApply">
        update t_role_apply t1
        set t1.status=2
        where t1.apply_num = #{roleApplyNum}
    </update>

</mapper>